<!DOCTYPE html>
<html>

<head>
	<meta charset='utf-8'>
	<meta http-equiv='X-UA-Compatible' content='IE=edge'>
	<title>Page Title</title>
	<meta name='viewport' content='width=device-width, initial-scale=1'>
	<style>
		body {
			background: #000;
		}
	</style>
	<!--<script src="script.js" type="module"></script>-->
	<script type="module">
		import { Chart } from './script.js';

		window.addEventListener('DOMContentLoaded', () => {
			document.getElementById('chart').append(getChart())
		})

		function getChart() {
			let c = new Chart();

			c.addHeadline('How does VersaTiles process OpenStreetMap data to create an interactive map?');

			c.addFlow([
				'OpenStreetMap data',
				'generator',
				'.mbtiles',
				'converter',
				'.versatiles',
				'server',
				'HTTP',
				'proxy / CDN',
				'HTTPS',
				'frontend',
				'interactive web map',
			])



			c.addHeadline('Which containers, packages or files can cover which part of this process chain?');

			let covDocM = c.addCover('docker', 'versatiles-maker', [0, 1, 2]);
			let covRust = c.addCover('rust', 'versatiles-rs', [1, 2]);
			let covNPMV = c.addCover('npm', 'node-versatiles', [2]);
			let covDoc0 = c.addCover('docker', 'versatiles', [1, 2]);
			let covDocS = c.addCover('docker', 'versatiles-server', [1, 2, 3, 4], 2);
			let covFFro = c.addCover('file', 'frontend.tar', [4], 3);

			c.addCoverGuides();



			c.addHeadline('How do containers, packages or files build on each other?');

			let depDoc0 = c.addDependency('docker', 'versatiles', 1, covDoc0);

			let depDocM = c.addDependency('docker', 'versatiles-maker', 0, covDocM);
			c.addDepDep(depDoc0, depDocM);

			let depDocS = c.addDependency('docker', 'versatiles-server', 2, covDocS);
			c.addDepDep(depDoc0, depDocS);

			let depRust = c.addDependency('rust', 'versatiles-rs', 1, covRust, { startDir: 'W', endDir: 'W', dy: 20, endContactShift: 10 });
			c.addDepDep(depRust, depDoc0);

			let depNPMV = c.addDependency('npm', 'node-versatiles', 2, covNPMV, { startDir: 'E', endDir: 'E', dy: 20 });

			let depFFro = c.addDependency('file', 'frontend.tar', 3, covFFro);
			c.addDepDep(depFFro, depDocS);

			let depFSty = c.addDependency('file', 'styles.tar', 3);
			c.addDepDep(depFSty, depFFro, { startDir: 'E', endDir: 'E' });

			let depFSpr = c.addDependency('file', 'sprites.tar', 3);
			c.addDepDep(depFSpr, depFFro, { startDir: 'E', endDir: 'E' });

			let depFFon = c.addDependency('file', 'fonts.tar', 3);
			c.addDepDep(depFFon, depFFro, { startDir: 'E', endDir: 'E' });



			c.addHeadline('Which repositories produce which containers, packages or files?');

			let repDoc0 = c.addRepo('versatiles-docker', 0)
				.addLink(depDocM, { endOffset: 20 })
				.addLink(depDoc0, { endOffset: 20, endContactShift: - 20 })
				.addLink(depDocS, { endOffset: 20, startDir: 'N', endDir: 'S' });
			c.addRepo('shortbread-tilemaker', 0).addLink(repDoc0);
			c.addRepo('versatiles-website', 0);
			c.addRepo('versatiles-docs', 0);

			c.addRepo('versatiles-rs', 1).addLink(depRust);
			c.addRepo('versatiles-spec', 1);

			c.addRepo('node-versatiles', 2).addLink(depNPMV);

			c.addRepo('versatiles-fonts', 3).addLink(depFFon, { startDir: 'W', endDir: 'W', offset: 15 });
			c.addRepo('versatiles-sprites', 3).addLink(depFSpr, { startDir: 'W', endDir: 'W', offset: 20 });
			c.addRepo('versatiles-styles', 3).addLink(depFSty, { startDir: 'W', endDir: 'W', offset: 25 });
			c.addRepo('versatiles-frontend', 3).addLink(depFFro, { startDir: 'W', endDir: 'W', offset: 30, endContactShift: 10 });

			return c.asSVG();
		}
	</script>
</head>

<body>
	<div id="chart"></div>
</body>

</html>